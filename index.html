<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NoteNest | Login</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
</head>
<body class="gradient-page">
  <main class="auth-layout">
    <section class="card auth-card">
      <h1 class="logo" style="text-align:center;margin:0;">NoteNest</h1>
      <p style="text-align:center;margin-bottom:1.5rem;" class="small">Class 9 CBSE Notes Portal</p>

      <form id="loginForm">
        <div class="field">
          <label for="name">Name *</label>
          <input id="name" required placeholder="Enter your name" />
        </div>
        <div class="field">
          <label for="email">Gmail (optional)</label>
          <input id="email" type="email" placeholder="you@gmail.com" />
        </div>
        <button class="btn btn-primary" type="submit" style="width:100%;">Get OTP</button>
        <p id="loginError" class="error"></p>
      </form>
    </section>
  </main>

  <div class="modal" id="otpModal" aria-hidden="true">
    <div class="card modal-content">
      <h3 style="margin-top:0;">OTP Verification</h3>
      <p class="small">Use this OTP: <strong id="otpCode"></strong></p>
      <div class="field">
        <label for="otpInput">Enter 6-digit OTP</label>
        <input id="otpInput" maxlength="6" inputmode="numeric" placeholder="123456" />
      </div>
      <button class="btn btn-primary" id="verifyOtp" type="button" style="width:100%;">Verify OTP</button>
      <p id="otpError" class="error"></p>
    </div>
  </div>

  <footer class="footer">Made by Roshan with love ❤️</footer>

  <script src="common.js"></script>
  <script>
    let generatedOtp = '';
    let pendingUser = null;

    document.getElementById('loginForm').addEventListener('submit', (event) => {
      event.preventDefault();
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim().toLowerCase();
      const loginError = document.getElementById('loginError');

      if (!name) {
        loginError.textContent = 'Name is required.';
        return;
      }

      loginError.textContent = '';
      pendingUser = { name, email, isAdmin: email === ADMIN_EMAIL };
      generatedOtp = String(Math.floor(100000 + Math.random() * 900000));
      document.getElementById('otpCode').textContent = generatedOtp;
      document.getElementById('otpInput').value = '';
      document.getElementById('otpError').textContent = '';
      document.getElementById('otpModal').classList.add('open');
    });

    document.getElementById('verifyOtp').addEventListener('click', () => {
      const entered = document.getElementById('otpInput').value.trim();
      const otpError = document.getElementById('otpError');

      if (entered !== generatedOtp) {
        otpError.textContent = 'Wrong OTP. Please try again.';
        return;
      }

      setSession({ ...pendingUser, loggedIn: true });
      window.location.href = pendingUser.isAdmin ? 'admin.html' : 'home.html';
    });

    // Close modal when background is clicked.
    document.getElementById('otpModal').addEventListener('click', (event) => {
      if (event.target.id === 'otpModal') {
        document.getElementById('otpModal').classList.remove('open');
      }
    });
  </script>
</body>
</html>
